<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test - Bumba Fresh</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .pending { background-color: #fff3cd; border-color: #ffeaa7; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        input { width: 300px; padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ Bumba Fresh API Connection Test</h1>
    
    <div id="backend-test" class="test pending">
        <h3>Backend Server Test</h3>
        <p>Testing connection to backend API...</p>
        <button onclick="testBackend()">Test Backend Connection</button>
        <pre id="backend-result">Waiting...</pre>
    </div>

    <div id="database-test" class="test pending">
        <h3>Database Connection Test</h3>
        <p>Testing database connectivity through backend...</p>
        <button onclick="testDatabase()">Test Database</button>
        <pre id="database-result">Waiting...</pre>
    </div>

    <div id="registration-test" class="test pending">
        <h3>User Registration Test</h3>
        <p>Test creating a new account:</p>
        <input type="email" id="reg-email" placeholder="test@example.com" value="test@example.com">
        <input type="password" id="reg-password" placeholder="password123" value="TestPassword123">
        <input type="text" id="reg-firstname" placeholder="First Name" value="Test">
        <input type="text" id="reg-lastname" placeholder="Last Name" value="User">
        <br>
        <button onclick="testRegistration()">Test Registration</button>
        <pre id="registration-result">Waiting...</pre>
    </div>

    <div id="login-test" class="test pending">
        <h3>Login Test</h3>
        <p>Test login with existing account:</p>
        <input type="email" id="login-email" placeholder="admin@gmail.com" value="admin@gmail.com">
        <input type="password" id="login-password" placeholder="password" value="password">
        <br>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testLoginWithNewAccount()">Login with Test Account</button>
        <pre id="login-result">Waiting...</pre>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let authToken = null;

        async function makeRequest(url, options = {}) {
            try {
                const headers = {
                    'Content-Type': 'application/json',
                    ...options.headers
                };

                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const response = await fetch(url, {
                    ...options,
                    headers
                });

                const data = await response.json();
                return {
                    status: response.status,
                    ok: response.ok,
                    data
                };
            } catch (error) {
                return {
                    status: 0,
                    ok: false,
                    data: { error: error.message }
                };
            }
        }

        async function testBackend() {
            const result = document.getElementById('backend-result');
            const container = document.getElementById('backend-test');
            
            result.textContent = 'Testing...';
            
            // Test health endpoint
            const healthResponse = await makeRequest(`${API_URL}/health`);
            
            if (healthResponse.ok) {
                container.className = 'test success';
                result.textContent = `‚úÖ Backend Connected!\n${JSON.stringify(healthResponse.data, null, 2)}`;
            } else {
                container.className = 'test error';
                result.textContent = `‚ùå Backend Connection Failed!\nStatus: ${healthResponse.status}\n${JSON.stringify(healthResponse.data, null, 2)}`;
            }
        }

        async function testDatabase() {
            const result = document.getElementById('database-result');
            const container = document.getElementById('database-test');
            
            result.textContent = 'Testing database connection...';
            
            // Test a simple API endpoint that uses the database
            const mealsResponse = await makeRequest(`${API_URL}/api/meals`);
            
            if (mealsResponse.ok) {
                container.className = 'test success';
                result.textContent = `‚úÖ Database Connected!\n${JSON.stringify(mealsResponse.data, null, 2)}`;
            } else {
                container.className = 'test error';
                result.textContent = `‚ùå Database Connection Failed!\nStatus: ${mealsResponse.status}\n${JSON.stringify(mealsResponse.data, null, 2)}`;
            }
        }

        async function testRegistration() {
            const result = document.getElementById('registration-result');
            const container = document.getElementById('registration-test');
            
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const firstName = document.getElementById('reg-firstname').value;
            const lastName = document.getElementById('reg-lastname').value;
            
            result.textContent = 'Testing registration...';
            
            const registerResponse = await makeRequest(`${API_URL}/api/auth/register`, {
                method: 'POST',
                body: JSON.stringify({
                    email,
                    password,
                    firstName,
                    lastName
                })
            });
            
            if (registerResponse.ok) {
                container.className = 'test success';
                authToken = registerResponse.data.token;
                result.textContent = `‚úÖ Registration Successful!\nUser: ${registerResponse.data.user.email}\nToken received: ${authToken ? 'Yes' : 'No'}`;
            } else {
                container.className = 'test error';
                result.textContent = `‚ùå Registration Failed!\nStatus: ${registerResponse.status}\n${JSON.stringify(registerResponse.data, null, 2)}`;
            }
        }

        async function testLogin() {
            const result = document.getElementById('login-result');
            const container = document.getElementById('login-test');
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            result.textContent = 'Testing login...';
            
            const loginResponse = await makeRequest(`${API_URL}/api/auth/login`, {
                method: 'POST',
                body: JSON.stringify({
                    email,
                    password
                })
            });
            
            if (loginResponse.ok) {
                container.className = 'test success';
                authToken = loginResponse.data.token;
                result.textContent = `‚úÖ Login Successful!\nUser: ${loginResponse.data.user.email}\nToken received: ${authToken ? 'Yes' : 'No'}`;
            } else {
                container.className = 'test error';
                result.textContent = `‚ùå Login Failed!\nStatus: ${loginResponse.status}\n${JSON.stringify(loginResponse.data, null, 2)}`;
            }
        }

        async function testLoginWithNewAccount() {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = password;
            
            await testLogin();
        }

        // Auto-run backend test on page load
        window.onload = function() {
            testBackend();
        };
    </script>
</body>
</html>
    
    <script>
// Test API Connection
async function testAPIConnection() {
  console.log('üß™ Testing API Connection...');
  
  const API_URL = 'http://localhost:8000/api';
  
  try {
    // Test health endpoint
    console.log('1. Testing health endpoint...');
    const healthResponse = await fetch('http://localhost:8000/health');
    const healthData = await healthResponse.json();
    console.log('‚úÖ Health check:', healthData);
    
    // Test registration
    console.log('\n2. Testing user registration...');
    const registerData = {
      email: 'test@example.com',
      password: 'TestPassword123',
      firstName: 'Test',
      lastName: 'User'
    };
    
    const registerResponse = await fetch(`${API_URL}/auth/register`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(registerData)
    });
    
    if (registerResponse.ok) {
      const registerResult = await registerResponse.json();
      console.log('‚úÖ Registration successful:', registerResult);
      
      // Test login
      console.log('\n3. Testing user login...');
      const loginResponse = await fetch(`${API_URL}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          email: registerData.email,
          password: registerData.password
        })
      });
      
      if (loginResponse.ok) {
        const loginResult = await loginResponse.json();
        console.log('‚úÖ Login successful:', loginResult);
        
        // Test token verification
        console.log('\n4. Testing token verification...');
        const verifyResponse = await fetch(`${API_URL}/auth/verify`, {
          headers: {
            'Authorization': `Bearer ${loginResult.token}`
          }
        });
        
        if (verifyResponse.ok) {
          const verifyResult = await verifyResponse.json();
          console.log('‚úÖ Token verification successful:', verifyResult);
        } else {
          console.log('‚ùå Token verification failed:', await verifyResponse.text());
        }
      } else {
        console.log('‚ùå Login failed:', await loginResponse.text());
      }
    } else {
      const errorText = await registerResponse.text();
      if (errorText.includes('Email already exists')) {
        console.log('‚ÑπÔ∏è  User already exists, testing login directly...');
        
        const loginResponse = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: registerData.email,
            password: registerData.password
          })
        });
        
        if (loginResponse.ok) {
          const loginResult = await loginResponse.json();
          console.log('‚úÖ Login successful:', loginResult);
        } else {
          console.log('‚ùå Login failed:', await loginResponse.text());
        }
      } else {
        console.log('‚ùå Registration failed:', errorText);
      }
    }
    
    console.log('\nüéâ API connection test completed!');
    console.log('üìç Your frontend should now be able to connect to the backend.');
    
  } catch (error) {
    console.error('‚ùå API test failed:', error.message);
    console.log('\nüí° Make sure the backend server is running on port 8000');
    console.log('üí° Run: cd backend && npm run dev');
  }
}
    </script>
</body>
</html>
